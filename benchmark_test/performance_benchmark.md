# 性能指标

## 环境

**CPU**: Intel(R) Core(TM) i7-8700 CPU @ 3.20GHz  (12 Cores)

**GPU**: GeForce GTX 1060 6GB  、 GeForce GTX 1660 6GB

## 数据

本次测试所使用的数据集为 SIFT1B ，共有十亿条128维的向量。关于该数据集的详细信息请参考：http://corpus-texmex.irisa.fr/。

## 说明

本文中用到的一些符号及专用名词说明如下：

| 专用名词 | 解释                                     |
| -------- | ---------------------------------------- |
| nq       | 查询的目标向量条目数，在搜索时定义。     |
| topk     | 与查询的目标向量最相似的 topk 个结果。   |
| time     | 批量查询时的总查询时间                   |
| nprobe   | 查询时需要搜索的分桶数目，在搜索时定义。 |

（注：测试性能与nprobe值相关，性能随着nprobe增大而降低，但是精确率会随之增加。用户可根据具体场景要求设置nprobe. ）

各类型索引如何选择可参考：https://milvus.io/cn/blogs/2019-12-03-select-index.md

测试参数设置：nlist=4096, index_file_size=2048

## 测试结果

[sift1m测试结果](performance_benchmark.md#sift1m): 该测试中，选取了sift1B数据集中的前1,000,000条向量。

[sift10m测试结果](performance_benchmark.md#sift10m): 该测试中，选取了sift1B数据集中的前10,000,000条向量。

[sift100m测试结果](performance_benchmark.md#sift100m): 该测试中，选取了sift1B数据集中的前100,000,000条向量。

本次测试过程中，数据每10万为一个批次导入milvus中，10万条128维的向量**导入约耗时**：0.7S。

## sift1m

##### 索引：ivf_sq8

(索引建立耗时：14s)

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.6%  | 97.0%  | 97.2%  |
| topk=10  | 96.2%  | 95.7%  | 95.8%  |
| topk=100 | 93.0%  | 92.4%  | 92.8%  |
| topk=500 | 87.8%  | 87.1%  | 87.4%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.002  | 0.002   | 0.002    | 0.002    |
| nq=10   | 0.015  | 0.015   | 0.015    | 0.016    |
| nq=100  | 0.089  | 0.82    | 0.099    | 0.107    |
| nq=500  | 0.389  | 0.390   | 0.401    | 0.448    |
| nq=1000 | 0.744  | 0.739   | 0.770    | 0.846    |



##### 索引ivf_sq8h

(索引建立耗时：10s)

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.8%  | 97.0%  | 97.2%  |
| topk=10  | 96.6%  | 96.1%  | 96.7%  |
| topk=100 | 92.8%  | 92.7%  | 92.9%  |
| topk=500 | 87.6%  | 87.0%  | 86.8%  |

**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    |        |         |          |          |
| nq=10   |        |         |          |          |
| nq=100  |        |         |          |          |
| nq=500  |        |         |          |          |
| nq=1000 |        |         |          |          |





## sift10m

##### 索引：ivf_sq8

(索引建立耗时：138s)

(nprobe:128)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 95.2%  | 95.6%  | 95.2%  |
| topk=10  | 95.2%  | 95.0%  | 94.8%  |
| topk=100 | 94.4%  | 93.9%  | 93.7%  |
| topk=500 | 91.7%  | 91.1%  | 91.3%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.004  | 0.004   | 0.004    | 0.005    |
| nq=10   | 0.020  | 0.020   | 0.022    | 0.025    |
| nq=100  | 0.123  | 0.118   | 0.120    | 0.130    |
| nq=500  | 0.535  | 0.549   | 0.552    | 0.621    |
| nq=1000 | 1.284  | 1.288   | 1.313    | 1.415    |

**将参数nlist和index_file_size调整为nlist=3072, index_file_size=1024后，索引ivf_sq8, 测试结果如下：**

(nprobe:32)

**准确率：**

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 95.2%  | 96.0%  | 97.4%  |
| topk=10  | 94.9%  | 94.5%  | 94.8%  |
| topk=100 | 92.7%  | 92.7%  | 93.1%  |
| topk=500 | 89.3%  | 89.2%  | 89.7%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.004  | 0.004   | 0.004    | 0.005    |
| nq=10   | 0.024  | 0.022   | 0.022    | 0.025    |
| nq=100  | 0.124  | 0.125   | 0.134    | 0.144    |
| nq=500  | 0.550  | 0.539   | 0.565    | 0.633    |
| nq=1000 | 1.071  | 1.062   | 1.157    | 1.287    |

##### 索引：ivf_sq8h

(nprobe:128)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.0%  | 96.2%  | 98.0%  |
| topk=10  | 96.6%  | 97.3%  | 96.3%  |
| topk=100 | 95.7%  | 95.9%  | 95.6%  |
| topk=500 | 92.8%  | 93.3%  | 92.8%  |

**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.004  | 0.004   | 0.004    | 0.005    |
| nq=10   | 0.017  | 0.022   | 0.018    | 0.021    |
| nq=100  | 0.089  | 0.090   | 0.092    | 0.106    |
| nq=500  | 0.381  | 0.385   | 0.393    | 0.451    |
| nq=1000 | 0.744  | 0.740   | 0.772    | 0.900    |



## sift100m

##### 索引：ivf_sq8

(索引建立耗时：229s)

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 96.6%  | 96.8%  | 96.6%  |
| topk=10  | 96.5%  | 96.6%  | 96.2%  |
| topk=100 | 94.8%  | 95.2%  | 94.8%  |
| topk=500 | 92.6%  | 92.8%  | 92.6%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.022  | 0.022   | 0.025    | 0.031    |
| nq=10   | 0.115  | 0.113   | 0.111    | 0.123    |
| nq=100  | 0.671  | 0.652   | 0.652    | 0.714    |
| nq=500  | 2.929  | 2.944   | 3.021    | 3.175    |
| nq=1000 | 5.834  | 5.835   | 5.912    | 6.302    |



##### 索引ivf_sq8h

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 96.8%  | 96.0%  | 96.4%  |
| topk=10  | 96.3%  | 95.8%  | 96.2%  |
| topk=100 | 95.5%  | 94.9%  | 95.3%  |
| topk=500 | 93.5%  | 92.4%  | 92.9%  |

**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.022  | 0.022   | 0.022    | 0.027    |
| nq=10   | 0.090  | 0.092   | 0.093    | 0.097    |
| nq=100  | 0.459  | 0.449   | 0.468    | 0.515    |
| nq=500  | 1.914  | 1.962   | 1.964    | 2.200    |
| nq=1000 | 3.809  | 3.770   | 3.907    | 4.275    |
